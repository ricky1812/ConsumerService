<!DOCTYPE html>
<html>
<head>
    <title>EventStreamHub - Live Events</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
        h1 { color: #333; }
        .controls { margin-bottom: 20px; }
        select, button, input { padding: 5px 10px; margin-right: 10px; }
        .event { padding: 10px; margin-bottom: 10px; background: white; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .timestamp { font-size: 0.8em; color: gray; }
        a { display: inline-block; margin-top: 10px; text-decoration: none; color: #007BFF; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
<h1>ðŸ“¡ EventStreamHub - Live Feed</h1>

<!-- Hyperlink to producer page -->
<a href="http://localhost:8081/index.html">Go to Producer Page</a>

<div class="controls">
    <label for="eventType">Filter by Event Type:</label>
    <select id="eventType">
        <option value="">All</option>
        <option value="order.created">order.created</option>
        <option value="payment.failed">payment.failed</option>
        <option value="user.registered">user.registered</option>
    </select>

    <label for="limit">Limit:</label>
    <input type="number" id="limit" min="1" max="100" value="10">

    <button id="applyFilter">Apply Filter</button>
</div>

<div id="events"></div>

<script>
    const eventContainer = document.getElementById("events");
    const eventTypeSelect = document.getElementById("eventType");
    const limitInput = document.getElementById("limit");
    const applyFilterBtn = document.getElementById("applyFilter");
    let eventSource;

    function connectSSE(filterType = "", limit = 10) {
        if (eventSource) {
            eventSource.close();
        }

        let url = `/events/streams?limit=${limit}`;
        if (filterType) {
            url += `&type=${encodeURIComponent(filterType)}`;
        }

        eventSource = new EventSource(url);

        eventSource.onmessage = function(event) {
            const data = JSON.parse(event.data);
            renderEvent(data);
        };

        eventSource.onerror = function(err) {
            console.error("EventSource failed:", err);
        };
    }

    function renderEvent(data) {
        const div = document.createElement("div");
        div.classList.add("event");
        div.innerHTML = `<strong>Type:</strong> ${data.type} <br>
                         <strong>Payload:</strong> ${data.payload} <br>
                         <span class="timestamp">${data.createdAt}</span>`;
        eventContainer.prepend(div);
    }

    applyFilterBtn.addEventListener("click", () => {
        eventContainer.innerHTML = ""; // clear previous events
        const filterType = eventTypeSelect.value;
        const limit = parseInt(limitInput.value) || 10;
        connectSSE(filterType, limit);
    });

    // Default: connect to all events with default limit
    connectSSE();
</script>
</body>
</html>
